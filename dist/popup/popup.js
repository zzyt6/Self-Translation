import{D as l,M as p}from"../chunks/types-BDZaX-gQ.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const i of e)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(e){const i={};return e.integrity&&(i.integrity=e.integrity),e.referrerPolicy&&(i.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?i.credentials="include":e.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(e){if(e.ep)return;e.ep=!0;const i=n(e);fetch(e.href,i)}})();const c={currentConfig:{...l},isSaving:!1},s={modeRadios:()=>document.querySelectorAll('input[name="translateMode"]'),providerSelect:()=>document.getElementById("provider"),apiKeyInput:()=>document.getElementById("apiKey"),concurrencyInput:()=>document.getElementById("concurrency"),btnSave:()=>document.getElementById("btn-save"),toggleApiVisibility:()=>document.getElementById("toggleApiVisibility"),toast:()=>document.getElementById("toast")};document.addEventListener("DOMContentLoaded",async()=>{await f(),y()});async function f(){try{const t=await chrome.storage.local.get("pluginConfig");if(t.pluginConfig)c.currentConfig={...l,...t.pluginConfig};else{const[r]=await chrome.tabs.query({active:!0,currentWindow:!0});if(r!=null&&r.id)try{const n=await chrome.tabs.sendMessage(r.id,{type:p.GET_CONFIG});n&&(c.currentConfig={...l,...n})}catch{console.log("Content script not ready")}}g()}catch(t){console.error("Failed to load config:",t),d("加载配置失败","error")}}function g(){const{currentConfig:t}=c;s.modeRadios().forEach(i=>{i.value===t.translateMode&&(i.checked=!0)});const n=s.providerSelect();n&&(n.value=t.provider);const o=s.apiKeyInput();o&&(o.value=t.apiKeys[t.provider]||"");const e=s.concurrencyInput();e&&(e.value=String(t.concurrency))}function y(){var t,r,n;(t=s.btnSave())==null||t.addEventListener("click",m),(r=s.toggleApiVisibility())==null||r.addEventListener("click",()=>{const o=s.apiKeyInput();o.type==="password"?o.type="text":o.type="password"}),(n=s.providerSelect())==null||n.addEventListener("change",o=>{const e=o.target.value;c.currentConfig.apiKeys[c.currentConfig.provider]=s.apiKeyInput().value,c.currentConfig.provider=e,s.apiKeyInput().value=c.currentConfig.apiKeys[e]||""})}async function m(){if(c.isSaving)return;c.isSaving=!0;const t=s.btnSave(),r=t.textContent||"保存配置";t.textContent="保存中...",t.disabled=!0;try{const n=document.querySelector('input[name="translateMode"]:checked'),o=(n==null?void 0:n.value)||"split",e=s.providerSelect().value,i=s.apiKeyInput().value.trim(),a=parseInt(s.concurrencyInput().value,10)||3;c.currentConfig.translateMode=o,c.currentConfig.provider=e,c.currentConfig.apiKeys[e]=i,c.currentConfig.concurrency=a,await chrome.storage.local.set({pluginConfig:c.currentConfig});const[u]=await chrome.tabs.query({active:!0,currentWindow:!0});u!=null&&u.id&&chrome.tabs.sendMessage(u.id,{type:p.SAVE_CONFIG,payload:c.currentConfig}).catch(()=>{}),d("设置已保存 ✨")}catch(n){console.error("Save failed:",n),d("保存失败","error")}finally{c.isSaving=!1,t.textContent=r,t.disabled=!1}}function d(t,r="success"){const n=s.toast(),o=document.getElementById("toast-msg");n&&o&&(o.textContent=t,n.style.borderColor=r==="success"?"#10b981":"#ef4444",n.classList.add("show"),setTimeout(()=>{n.classList.remove("show")},2e3))}
