(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))c(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&c(s)}).observe(document,{childList:!0,subtree:!0});function r(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function c(n){if(n.ep)return;n.ep=!0;const a=r(n);fetch(n.href,a)}})();var p=(e=>(e.START_TRANSLATION="START_TRANSLATION",e.START_INLINE_TRANSLATION="START_INLINE_TRANSLATION",e.START_BILINGUAL_TRANSLATION="START_BILINGUAL_TRANSLATION",e.TRANSLATION_PROGRESS="TRANSLATION_PROGRESS",e.TRANSLATION_COMPLETE="TRANSLATION_COMPLETE",e.TRANSLATION_ERROR="TRANSLATION_ERROR",e.RESTORE_PAGE="RESTORE_PAGE",e.GET_CONFIG="GET_CONFIG",e.SAVE_CONFIG="SAVE_CONFIG",e))(p||{});const u={provider:"deepseek",apiKeys:{},targetLanguage:"zh-CN",concurrency:3,enableCache:!0,translateMode:"split",enablePdfTranslation:!0,enableImageTranslation:!0,enableSubtitleTranslation:!0,ocrProvider:"tesseract",ocrApiKey:""},o={currentConfig:{...u},isSaving:!1},t={modeRadios:()=>document.querySelectorAll('input[name="translateMode"]'),providerSelect:()=>document.getElementById("provider"),apiKeyInput:()=>document.getElementById("apiKey"),concurrencyInput:()=>document.getElementById("concurrency"),enablePdfTranslation:()=>document.getElementById("enablePdfTranslation"),enableImageTranslation:()=>document.getElementById("enableImageTranslation"),enableSubtitleTranslation:()=>document.getElementById("enableSubtitleTranslation"),ocrProvider:()=>document.getElementById("ocrProvider"),ocrApiKey:()=>document.getElementById("ocrApiKey"),ocrApiKeyWrapper:()=>document.getElementById("ocrApiKeyWrapper"),btnSave:()=>document.getElementById("btn-save"),toggleApiVisibility:()=>document.getElementById("toggleApiVisibility"),toast:()=>document.getElementById("toast")};document.addEventListener("DOMContentLoaded",async()=>{await v(),I()});async function v(){try{const e=await chrome.storage.local.get("pluginConfig");if(e.pluginConfig)o.currentConfig={...u,...e.pluginConfig};else{const[i]=await chrome.tabs.query({active:!0,currentWindow:!0});if(i!=null&&i.id)try{const r=await chrome.tabs.sendMessage(i.id,{type:p.GET_CONFIG});r&&(o.currentConfig={...u,...r})}catch{console.log("Content script not ready")}}T()}catch(e){console.error("Failed to load config:",e),d("加载配置失败","error")}}function T(){const{currentConfig:e}=o;t.modeRadios().forEach(y=>{y.value===e.translateMode&&(y.checked=!0)});const r=t.providerSelect();r&&(r.value=e.provider);const c=t.apiKeyInput();c&&(c.value=e.apiKeys[e.provider]||"");const n=t.concurrencyInput();n&&(n.value=String(e.concurrency));const a=t.enablePdfTranslation();a&&(a.checked=e.enablePdfTranslation!==!1);const s=t.enableImageTranslation();s&&(s.checked=e.enableImageTranslation!==!1);const l=t.enableSubtitleTranslation();l&&(l.checked=e.enableSubtitleTranslation!==!1);const f=t.ocrProvider();f&&(f.value=e.ocrProvider||"tesseract");const g=t.ocrApiKey();g&&(g.value=e.ocrApiKey||""),m()}function I(){var e,i,r,c;(e=t.btnSave())==null||e.addEventListener("click",A),(i=t.toggleApiVisibility())==null||i.addEventListener("click",()=>{const n=t.apiKeyInput();n.type==="password"?n.type="text":n.type="password"}),(r=t.providerSelect())==null||r.addEventListener("change",n=>{const a=n.target.value;o.currentConfig.apiKeys[o.currentConfig.provider]=t.apiKeyInput().value,o.currentConfig.provider=a,t.apiKeyInput().value=o.currentConfig.apiKeys[a]||""}),(c=t.ocrProvider())==null||c.addEventListener("change",()=>{m()})}async function A(){if(o.isSaving)return;o.isSaving=!0;const e=t.btnSave(),i=e.textContent||"保存配置";e.textContent="保存中...",e.disabled=!0;try{const r=document.querySelector('input[name="translateMode"]:checked'),c=(r==null?void 0:r.value)||"split",n=t.providerSelect().value,a=t.apiKeyInput().value.trim(),s=parseInt(t.concurrencyInput().value,10)||3;o.currentConfig.translateMode=c,o.currentConfig.provider=n,o.currentConfig.apiKeys[n]=a,o.currentConfig.concurrency=s,o.currentConfig.enablePdfTranslation=t.enablePdfTranslation().checked,o.currentConfig.enableImageTranslation=t.enableImageTranslation().checked,o.currentConfig.enableSubtitleTranslation=t.enableSubtitleTranslation().checked,o.currentConfig.ocrProvider=t.ocrProvider().value,o.currentConfig.ocrApiKey=t.ocrApiKey().value.trim(),await chrome.storage.local.set({pluginConfig:o.currentConfig});const[l]=await chrome.tabs.query({active:!0,currentWindow:!0});l!=null&&l.id&&chrome.tabs.sendMessage(l.id,{type:p.SAVE_CONFIG,payload:o.currentConfig}).catch(()=>{}),d("设置已保存 ✨")}catch(r){console.error("Save failed:",r),d("保存失败","error")}finally{o.isSaving=!1,e.textContent=i,e.disabled=!1}}function d(e,i="success"){const r=t.toast(),c=document.getElementById("toast-msg");r&&c&&(c.textContent=e,r.style.borderColor=i==="success"?"#10b981":"#ef4444",r.classList.add("show"),setTimeout(()=>{r.classList.remove("show")},2e3))}function m(){const e=t.ocrProvider().value,i=t.ocrApiKeyWrapper();i&&(e==="ocr_space"?i.style.display="flex":i.style.display="none")}
