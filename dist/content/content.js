(function(){"use strict";const B={provider:"deepseek",apiKeys:{},targetLanguage:"zh-CN",concurrency:3,enableCache:!0,translateMode:"split"},M={START_TRANSLATION:"START_TRANSLATION",START_INLINE_TRANSLATION:"START_INLINE_TRANSLATION",START_BILINGUAL_TRANSLATION:"START_BILINGUAL_TRANSLATION",RESTORE_PAGE:"RESTORE_PAGE",GET_CONFIG:"GET_CONFIG"};console.log("[LLMç¿»è¯‘] Content Script å·²åŠ è½½");let b=!1,k=!1,E=null,w=null,S=null,L=null;const C={};let $=new Map,R=!1,A=!1,z=[];chrome.runtime.onMessage.addListener((e,t,r)=>(console.log("[LLMç¿»è¯‘] æ”¶åˆ°æ¶ˆæ¯:",e.type),e.type===M.START_TRANSLATION?(O(),r({success:!0})):e.type===M.START_INLINE_TRANSLATION?(P(),r({success:!0})):e.type===M.START_BILINGUAL_TRANSLATION?(G(),r({success:!0})):e.type===M.RESTORE_PAGE&&(R?K():A?F():U(),r({success:!0})),!1));async function O(){if(b){T("ç¿»è¯‘è¿›è¡Œä¸­...","info");return}if(k){T("å·²ç»æ˜¯åˆ†å±æ¨¡å¼","info");return}b=!0,x("translating");try{const e=await I();if(!e.apiKeys[e.provider]){T("è¯·å…ˆé…ç½® API Key","error"),b=!1,x("idle");return}const r=document.documentElement.outerHTML;oe(r),k=!0,await _(1e3),re(),T("æ­£åœ¨ç¿»è¯‘...","info"),await se(e),T("âœ“ ç¿»è¯‘å®Œæˆï¼","success"),x("done")}catch(e){console.error("[LLMç¿»è¯‘] é”™è¯¯:",e),T(`å¤±è´¥: ${e instanceof Error?e.message:"æœªçŸ¥é”™è¯¯"}`,"error"),x("idle")}finally{b=!1}}async function P(){if(b){T("ç¿»è¯‘è¿›è¡Œä¸­...","info");return}b=!0,R=!0,x("translating");try{const e=await I();if(!e.apiKeys[e.provider]){T("è¯·å…ˆé…ç½® API Key","error"),b=!1,x("idle");return}T("æ­£åœ¨ç¿»è¯‘...","info"),await ee(e),T("âœ“ ç¿»è¯‘å®Œæˆï¼","success"),x("done")}catch(e){console.error("[LLMç¿»è¯‘] é”™è¯¯:",e),T(`å¤±è´¥: ${e instanceof Error?e.message:"æœªçŸ¥é”™è¯¯"}`,"error"),x("idle")}finally{b=!1}}async function ee(e){const t=window.location.href;C[t]||(C[t]={});const r=C[t],c=Y(document.body,document);if(console.log(`[LLMç¿»è¯‘] åŸç½‘é¡µç¿»è¯‘ï¼šæ”¶é›†åˆ° ${c.length} ä¸ªæ–‡æœ¬èŠ‚ç‚¹`),c.length===0){console.log("[LLMç¿»è¯‘] æ²¡æœ‰æ‰¾åˆ°éœ€è¦ç¿»è¯‘çš„æ–‡æœ¬");return}$.clear(),c.forEach(n=>{$.set(n.node,n.originalText)});const g=[];c.forEach(n=>{r[n.originalText]?n.node.textContent=r[n.originalText]:g.push(n)});const y=c.length-g.length;if(console.log(`[LLMç¿»è¯‘] ç¼“å­˜å‘½ä¸­ ${y}ï¼Œéœ€ç¿»è¯‘ ${g.length}`),g.length===0){T("âœ“ ä»ç¼“å­˜åŠ è½½å®Œæˆï¼","success");return}const p=12,d=e.concurrency||3;let h=y;const u=[];for(let n=0;n<g.length;n+=p)u.push(g.slice(n,n+p));const a=async n=>{const s=n.map(o=>o.originalText);try{const o=await D(s,e);n.forEach((l,f)=>{o[f]&&o[f]!==l.originalText&&(l.node.textContent=o[f],r[l.originalText]=o[f])}),h+=n.length,T(`ç¿»è¯‘ä¸­... ${h}/${c.length}`,"info")}catch(o){console.error("[LLMç¿»è¯‘] æ‰¹æ¬¡ç¿»è¯‘å¤±è´¥:",o),h+=n.length}};for(let n=0;n<u.length;n+=d){const s=u.slice(n,n+d);await Promise.allSettled(s.map(o=>a(o))),n+d<u.length&&await _(100)}}function te(e){const t=["p","h1","h2","h3","h4","h5","h6","li","blockquote","td","th","pre","figcaption","div","section","article","header","footer","main","aside"],c=[...t,"ul","ol","table","form","dl","dt","dd"].join(", "),g=d=>!!(!/[a-zA-Z]/.test(d)||/^[\d\s\p{P}\p{S}]*$/u.test(d)||/^(if|for|while|function|class|import|export|const|let|var|return)\b/.test(d)),y=Array.from(e.querySelectorAll(t.join(", "))),p=[];for(const d of y){if(d.classList.contains("llm-bilingual-text")||d.closest(".llm-bilingual-text")||d.closest(".llm-translator-ignore")||d.closest("nav"))continue;const h=window.getComputedStyle(d);if(h.display==="none"||h.visibility==="hidden"||h.opacity==="0"||d.querySelector(c))continue;const u=(d.innerText||d.textContent||"").trim();if(!u||g(u))continue;const a=/^H[1-6]$/.test(d.tagName),n=u.split(/\s+/).length;if(!a&&n<5&&!/[?!ï¼Ÿï¼]/.test(u))continue;const s=d.getElementsByTagName("a");if(s.length>0){let o=0;for(let f=0;f<s.length;f++)o+=(s[f].innerText||"").length;const l=u.length;if(l>0&&o/l>.8&&l<200)continue}p.push(d)}return p}async function G(){if(b){T("ç¿»è¯‘è¿›è¡Œä¸­...","info");return}b=!0,A=!0,x("translating");try{const e=await I();if(!e.apiKeys[e.provider]){T("è¯·å…ˆé…ç½® API Key","error"),b=!1,A=!1,x("idle");return}await ne(e)?(T("âœ“ åŒè¯­å¯¹ç…§ç¿»è¯‘å®Œæˆï¼","success"),x("done")):(A=!1,b=!1,x("idle"))}catch(e){console.error("[LLMç¿»è¯‘] é”™è¯¯:",e),T(`å¤±è´¥: ${e instanceof Error?e.message:"æœªçŸ¥é”™è¯¯"}`,"error"),x("idle"),F()}finally{b=!1}}async function ne(e){const t=window.location.href;C[t]||(C[t]={});const r=C[t],c=te(document.body);if(console.log(`[LLMç¿»è¯‘] åŒè¯­ç¿»è¯‘(Blockæ¨¡å¼)ï¼šæ”¶é›†åˆ° ${c.length} ä¸ªå—çº§å…ƒç´ `),c.length===0)return T("æ²¡æœ‰æ‰¾åˆ°å¯ç¿»è¯‘çš„æ–‡æœ¬å—","info"),!1;const g=[],y=(o,l)=>{const f=o.lastElementChild;if(f&&f.classList.contains("llm-bilingual-text"))return;const m=document.createElement("div");m.className="llm-bilingual-text",m.textContent=l,m.style.display="block",m.style.marginTop="6px",m.style.marginBottom="8px",m.style.color="#595959",m.style.fontSize="14px",m.style.lineHeight="1.6",m.style.fontWeight="normal",m.style.padding="6px 10px",m.style.backgroundColor="rgba(242, 243, 245, 0.6)",m.style.borderLeft="3px solid #667eea",m.style.borderRadius="4px",m.style.width="fit-content",m.style.maxWidth="100%",m.style.boxSizing="border-box",/^H[1-6]$/.test(o.tagName)&&(m.style.marginTop="8px",m.style.fontWeight="bold",m.style.fontSize="15px"),o.appendChild(m),z.push(m)};let p=!1;if(c.forEach(o=>{const l=(o.innerText||o.textContent||"").trim();l&&(p=!0),r[l]?y(o,r[l]):g.push({el:o,text:l})}),!p)return!1;const d=c.length-g.length;if(console.log(`[LLMç¿»è¯‘] ç¼“å­˜å‘½ä¸­ ${d}ï¼Œéœ€ç¿»è¯‘ ${g.length}`),g.length===0)return d>0&&T("âœ“ ä»ç¼“å­˜åŠ è½½å®Œæˆï¼","success"),!0;const h=8,u=e.concurrency||3;let a=d;const n=[];for(let o=0;o<g.length;o+=h)n.push(g.slice(o,o+h));const s=async o=>{const l=o.map(f=>f.text);try{const f=await D(l,e);o.forEach((m,v)=>{f[v]&&(y(m.el,f[v]),r[m.text]=f[v])}),a+=o.length,T(`ç¿»è¯‘ä¸­... ${a}/${c.length}`,"info")}catch(f){console.error("[LLMç¿»è¯‘] æ‰¹æ¬¡ç¿»è¯‘å¤±è´¥:",f),a+=o.length}};for(let o=0;o<n.length;o+=u){const l=n.slice(o,o+u);await Promise.allSettled(l.map(f=>s(f))),o+u<n.length&&await _(100)}return!0}function F(){z.forEach(e=>e.remove()),z=[],A=!1,x("idle"),T("âœ“ å·²æ¢å¤åŸé¡µé¢","success"),console.log("[LLMç¿»è¯‘] åŒè¯­å¯¹ç…§ç¿»è¯‘å·²æ¢å¤")}function K(){$.forEach((e,t)=>{t.parentNode&&(t.textContent=e)}),$.clear(),R=!1,x("idle"),T("âœ“ å·²æ¢å¤åŸé¡µé¢","success"),console.log("[LLMç¿»è¯‘] åŸç½‘é¡µç¿»è¯‘å·²æ¢å¤")}function oe(e){E=document.createElement("div"),E.id="llm-split-container",E.style.cssText=`
    position: fixed; top: 0; left: 0;
    width: 100vw; height: 100vh;
    display: flex; z-index: 2147483640;
    background: #fff;
  `,S=document.createElement("iframe"),S.id="llm-left-iframe",S.style.cssText=`
    width: 50%; height: 100%;
    border: none; border-right: 3px solid #667eea;
  `,L=document.createElement("iframe"),L.id="llm-right-iframe",L.style.cssText=`
    width: 50%; height: 100%; border: none;
  `;const t=W("ğŸ“„ åŸæ–‡","left"),r=W("ğŸŒ è¯‘æ–‡","right");E.appendChild(S),E.appendChild(L),E.appendChild(t),E.appendChild(r),document.body.appendChild(E),document.body.style.overflow="hidden",H(S,e),H(L,e),console.log("[LLMç¿»è¯‘] åˆ†å±åˆ›å»ºå®Œæˆ")}function H(e,t){const r=e.contentDocument;if(r){let c=t;c=c.replace(/<script\b[^>]*>([\s\S]*?)<\/script>/gmi,""),c=c.replace(/<button[^>]*id="llm-translate-fab"[^>]*>[\s\S]*?<\/button>/gmi,""),c=c.replace(/<div[^>]*id="llm-main-notification"[^>]*>[\s\S]*?<\/div>/gmi,""),c=c.replace(/<style[^>]*id="llm-translate-styles"[^>]*>[\s\S]*?<\/style>/gmi,""),r.open(),r.write(c),r.close()}}function W(e,t){const r=document.createElement("div"),c=t==="left"?"calc(25% - 30px)":"calc(75% - 30px)";return r.style.cssText=`
    position: fixed; top: 50px; left: ${c};
    padding: 6px 16px;
    background: ${t==="left"?"rgba(0,0,0,0.7)":"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"};
    color: white; border-radius: 15px;
    font-size: 13px; font-weight: 500;
    z-index: 2147483645;
    font-family: -apple-system, sans-serif;
    pointer-events: none;
  `,r.textContent=e,r}function re(){if(!(S!=null&&S.contentDocument)||!(L!=null&&L.contentDocument))return;const e=S.contentDocument,t=L.contentDocument,r=S.contentWindow,c=L.contentWindow;if(!r||!c)return;console.log("[Debug] å¼€å§‹ setupScrollSync...");let g=0;const y=(a,n,s)=>{a.setAttribute("data-sync-id",s),n.setAttribute("data-sync-id",s),g++;const o=Math.min(a.children.length,n.children.length);for(let l=0;l<o;l++)y(a.children[l],n.children[l],`${s}-${l}`)};y(e.body,t.body,"0"),console.log(`[Debug] DOM æ‰“æ ‡å®Œæˆï¼Œæ ‡è®°äº† ${g} å¯¹å…ƒç´ `);let p=null,d=null;const h=(a,n)=>{if(p&&p!==n)return;p=n,d&&clearTimeout(d),d=setTimeout(()=>{p=null},150);const s=a.target,o=n==="left"?t:e,l=n==="left"?c:r;try{if(s===e||s===t){const f=n==="left"?r:c;(Math.abs(l.scrollY-f.scrollY)>2||Math.abs(l.scrollX-f.scrollX)>2)&&l.scrollTo(f.scrollX,f.scrollY)}else if(s instanceof Element){const f=s.getAttribute("data-sync-id");if(!f)return;const m=o.querySelector(`[data-sync-id="${f}"]`);if(m){const v=m;(Math.abs(v.scrollTop-s.scrollTop)>2||Math.abs(v.scrollLeft-s.scrollLeft)>2)&&(v.scrollTop=s.scrollTop,v.scrollLeft=s.scrollLeft)}else console.warn(`[Debug] æœªæ‰¾åˆ°å¯¹åº”å…ƒç´  ID: ${f}`)}}catch(f){console.error("[Debug] åŒæ­¥å‡ºé”™:",f)}},u={capture:!0,passive:!0};e.addEventListener("scroll",a=>h(a,"left"),u),t.addEventListener("scroll",a=>h(a,"right"),u),r.addEventListener("scroll",a=>{a.target===e&&h(a,"left")},u),c.addEventListener("scroll",a=>{a.target===t&&h(a,"right")},u)}async function se(e){if(!(L!=null&&L.contentDocument))throw console.error("[LLMç¿»è¯‘] æ— æ³•è®¿é—®å³ä¾§ iframe"),new Error("æ— æ³•è®¿é—®å³ä¾§ iframe");const t=L.contentDocument,r=window.location.href;console.log("[LLMç¿»è¯‘] å¼€å§‹ç¿»è¯‘:",r),C[r]||(C[r]={});const c=C[r],g=Y(t.body,t);if(console.log(`[LLMç¿»è¯‘] æ”¶é›†åˆ° ${g.length} ä¸ªæ–‡æœ¬èŠ‚ç‚¹`),g.length===0){console.log("[LLMç¿»è¯‘] æ²¡æœ‰æ‰¾åˆ°éœ€è¦ç¿»è¯‘çš„æ–‡æœ¬");return}const y=[];g.forEach(s=>{c[s.originalText]?s.node.textContent=c[s.originalText]:y.push(s)});const p=g.length-y.length;if(console.log(`[LLMç¿»è¯‘] ç¼“å­˜å‘½ä¸­ ${p}ï¼Œéœ€ç¿»è¯‘ ${y.length}`),y.length===0){T("âœ“ ä»ç¼“å­˜åŠ è½½å®Œæˆï¼","success");return}const d=12,h=e.concurrency||3;let u=p;const a=[];for(let s=0;s<y.length;s+=d)a.push(y.slice(s,s+d));console.log(`[LLMç¿»è¯‘] å…± ${a.length} ä¸ªæ‰¹æ¬¡ï¼Œå¹¶å‘æ•° ${h}`);const n=async s=>{const o=s.map(l=>l.originalText);try{const l=await D(o,e);s.forEach((f,m)=>{l[m]&&l[m]!==f.originalText&&(f.node.textContent=l[m],c[f.originalText]=l[m])}),u+=s.length,T(`ç¿»è¯‘ä¸­... ${u}/${g.length}`,"info")}catch(l){console.error("[LLMç¿»è¯‘] æ‰¹æ¬¡ç¿»è¯‘å¤±è´¥:",l),u+=s.length}};for(let s=0;s<a.length;s+=h){const o=a.slice(s,s+h);await Promise.allSettled(o.map(l=>n(l))),s+h<a.length&&await _(100)}T("âœ“ ç¿»è¯‘å®Œæˆï¼","success")}function Y(e,t){var h;const r=[],c=new Set,g=new Set(["SCRIPT","STYLE","NOSCRIPT","IFRAME","SVG","INPUT","TEXTAREA","SELECT","CANVAS","VIDEO","AUDIO","IMG","BR","HR"]),y=u=>{if(/^[\d\s\p{P}\p{S}]*$/u.test(u)||/^https?:\/\//.test(u)||/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(u)||/^(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s+\d{1,2},?\s*\d{4}$/i.test(u)||/^v?\d+(\.\d+)+$/i.test(u)||/^\d+$/.test(u)||!/[a-zA-Z]/.test(u))return!0;const a=u.trim();return!!(/^[a-zA-Z0-9_]+(\.|::)[a-zA-Z0-9_]+([.:][a-zA-Z0-9_]+)*$/.test(a)||!a.includes(" ")&&/^[a-z]+[A-Z][a-zA-Z0-9]*$/.test(a)||a.includes("_")&&!a.includes(" ")||/^[a-zA-Z0-9_.]+\(.*\)$/.test(a)||a.startsWith("/")||a.startsWith("-"))},p=t.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:u=>{var s,o;const a=u.parentElement;if(!a||g.has(a.tagName)||a.closest("code, pre"))return NodeFilter.FILTER_REJECT;const n=((s=u.textContent)==null?void 0:s.trim())||"";if(n.length===0||y(n))return NodeFilter.FILTER_REJECT;try{const l=(o=t.defaultView)==null?void 0:o.getComputedStyle(a);if((l==null?void 0:l.display)==="none"||(l==null?void 0:l.visibility)==="hidden")return NodeFilter.FILTER_REJECT}catch{}return n.length>15&&c.has(n)?NodeFilter.FILTER_REJECT:(c.add(n),NodeFilter.FILTER_ACCEPT)}});let d;for(;d=p.nextNode();)r.push({node:d,originalText:((h=d.textContent)==null?void 0:h.trim())||""});return r}async function D(e,t){var u,a,n;const r=t.apiKeys[t.provider],c=ie(t.provider),g=t.targetLanguage==="zh-CN"?"ç®€ä½“ä¸­æ–‡":t.targetLanguage,y=e.map((s,o)=>`${o}: ${s}`).join(`
`),p=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({model:"deepseek-chat",messages:[{role:"system",content:`ç¿»è¯‘æˆ${g}ã€‚æ ¼å¼ï¼šæ¯è¡Œ "åºå·: ç¿»è¯‘"ã€‚åªè¾“å‡ºç¿»è¯‘ã€‚`},{role:"user",content:y}],temperature:.1})});if(!p.ok)throw new Error(`API å¤±è´¥: ${p.status}`);const h=((n=(a=(u=(await p.json()).choices)==null?void 0:u[0])==null?void 0:a.message)==null?void 0:n.content)||"";return e.map((s,o)=>{const l=h.match(new RegExp(`^${o}[ï¼š:\\s]+(.+)$`,"m"));return l?l[1].trim():s})}function ie(e){const t={deepseek:"https://api.deepseek.com/chat/completions",qwen:"https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation",zhipu:"https://open.bigmodel.cn/api/paas/v4/chat/completions"};return t[e]||t.deepseek}async function le(e){return new Promise((t,r)=>{var c,g;try{if(!((c=chrome.runtime)!=null&&c.id))throw new Error("Extension context invalidated");chrome.runtime.sendMessage(e,y=>{var d;const p=chrome.runtime.lastError;if(p){if((d=p.message)!=null&&d.includes("Extension context invalidated")){T("æ’ä»¶å·²æ›´æ–°ï¼Œè¯·åˆ·æ–°é¡µé¢åé‡è¯•","error");const h=document.getElementById("llm-translate-fab");h&&h.remove()}r(p)}else t(y)})}catch(y){if((g=y.message)!=null&&g.includes("Extension context invalidated")){T("æ’ä»¶å·²æ›´æ–°ï¼Œè¯·åˆ·æ–°é¡µé¢åé‡è¯•","error");const p=document.getElementById("llm-translate-fab");p&&p.remove()}r(y)}})}async function I(){try{const e=await chrome.storage.local.get("pluginConfig");return e.pluginConfig?{...B,...e.pluginConfig}:await le({type:M.GET_CONFIG})||B}catch(e){return console.warn("è·å–é…ç½®å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤é…ç½®:",e),B}}function U(){E&&(E.remove(),E=null,S=null,L=null,document.body.style.overflow="",k=!1,X())}function _(e){return new Promise(t=>setTimeout(t,e))}function X(){w&&(w.remove(),w=null)}function T(e,t="info"){const r={info:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",success:"linear-gradient(135deg, #11998e 0%, #38ef7d 100%)",error:"linear-gradient(135deg, #eb3349 0%, #f45c43 100%)"};w||(w=document.createElement("div"),w.id="llm-main-notification",w.style.cssText=`
      position: fixed; top: 10px; right: 20px;
      padding: 10px 20px; color: white; border-radius: 8px;
      font-size: 14px; font-family: -apple-system, sans-serif;
      z-index: 2147483647;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    `,document.body.appendChild(w)),w.textContent=e,w.style.background=r[t],(t==="success"||t==="error")&&setTimeout(()=>{w&&(w.style.opacity="0",w.style.transition="opacity 0.3s",setTimeout(X,300))},t==="error"?5e3:3e3)}let i=null,N=!1,J=0,Z=0,j=0,V=0;function q(){if(i||document.getElementById("llm-translate-fab"))return;i=document.createElement("button"),i.id="llm-translate-fab";const e=`
        <span style="font-family: 'Songti SC', 'SimSun', serif; font-size: 20px; font-weight: 700; margin-right: 2px;">è¯‘</span>
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.9;">
            <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1-1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/>
        </svg>
    `;i.innerHTML=e,i.title="ç‚¹å‡»å¼€å§‹ AI ç¿»è¯‘",i.style.cssText=`
        position: fixed;
        bottom: 100px;
        right: 20px;
        width: 52px;
        height: 52px;
        border-radius: 26px; /* åœ†å½¢/èƒ¶å›Š */
        border: 1px solid rgba(255, 255, 255, 0.2);
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.9) 0%, rgba(118, 75, 162, 0.9) 100%);
        backdrop-filter: blur(8px);
        color: white;
        cursor: grab;
        z-index: 2147483646;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 8px 32px rgba(31, 38, 135, 0.25);
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        user-select: none;
        font-family: system-ui, -apple-system, sans-serif;
    `,i.onmouseenter=()=>{i&&!N&&(i.style.transform="translateY(-2px) scale(1.05)",i.style.boxShadow="0 12px 40px rgba(102, 126, 234, 0.4)")},i.onmouseleave=()=>{i&&!N&&(i.style.transform="translateY(0) scale(1)",i.style.boxShadow="0 8px 32px rgba(31, 38, 135, 0.25)")},i.onmousedown=t=>{if(!i)return;N=!1,J=t.clientX,Z=t.clientY;const r=i.getBoundingClientRect();j=r.left,V=r.top,i.style.cursor="grabbing",i.style.transform="scale(0.95)";const c=y=>{const p=y.clientX-J,d=y.clientY-Z;if((Math.abs(p)>5||Math.abs(d)>5)&&(N=!0),N&&i){let h=j+p,u=V+d;const a=window.innerWidth-56,n=window.innerHeight-56;h=Math.max(0,Math.min(h,a)),u=Math.max(0,Math.min(u,n)),i.style.right="auto",i.style.bottom="auto",i.style.left=h+"px",i.style.top=u+"px",i.style.transition="none"}},g=()=>{i&&(i.style.cursor="grab",i.style.transform="translateY(0) scale(1)",i.style.transition="all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1)"),document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",g),N||ae()};document.addEventListener("mousemove",c),document.addEventListener("mouseup",g),t.preventDefault()},i.onclick=t=>{t.preventDefault()},document.body.appendChild(i),console.log("[LLMç¿»è¯‘] æµ®åŠ¨æŒ‰é’®å·²åˆ›å»º")}function ae(){k||R||A?(R?K():A?F():U(),x("idle")):I().then(e=>{e.translateMode==="inline"?P():e.translateMode==="bilingual"?G():O()})}function x(e){if(i)switch(e){case"translating":i.style.background="linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%)",i.style.width="52px",i.innerHTML=`
                <svg width="24" height="24" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="25" cy="25" r="20" fill="none" stroke="white" stroke-width="5" stroke-linecap="round" stroke-dasharray="80, 200">
                        <animateTransform 
                            attributeName="transform" 
                            attributeType="XML" 
                            type="rotate" 
                            from="0 25 25" 
                            to="360 25 25" 
                            dur="1s" 
                            repeatCount="indefinite" />
                    </circle>
                </svg>
            `,i.title="AI æ­£åœ¨æ€è€ƒ...";break;case"done":i.style.background="linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)",i.style.width="auto",i.style.padding="0 16px",i.style.borderRadius="26px",i.innerHTML=`
                <span style="font-weight: 600; font-size: 14px; margin-right: 4px;">â†º</span>
                <span style="font-weight: 500; font-size: 14px;">è¿˜åŸ</span>
            `,i.title="ç‚¹å‡»æ¢å¤åŸæ–‡";break;default:i.style.background="linear-gradient(135deg, rgba(102, 126, 234, 0.95) 0%, rgba(118, 75, 162, 0.95) 100%)",i.style.width="52px",i.style.height="52px",i.style.padding="0",i.style.borderRadius="26px",i.innerHTML=`
                <span style="font-family: 'Songti SC', 'SimSun', serif; font-size: 20px; font-weight: 700; margin-right: 2px;">è¯‘</span>
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.9;">
                    <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1-1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/>
                </svg>
            `,i.title="ç‚¹å‡»å¼€å§‹ AI ç¿»è¯‘"}}function Q(){if(document.getElementById("llm-translate-styles"))return;const e=document.createElement("style");e.id="llm-translate-styles",e.textContent=`
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
    `,document.head.appendChild(e)}function ce(){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{Q(),q()}):(Q(),q())}ce()})();
